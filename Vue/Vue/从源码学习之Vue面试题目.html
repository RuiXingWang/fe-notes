<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue 从源码学习之面试题目 | 余生的前端笔记本</title>
    <meta name="description" content="记录着很多很正常很平凡的代码">
    <link rel="shortcut icon" href="favicon.ico">
    
    <link rel="preload" href="/fe-notes/assets/css/0.styles.b7c73eeb.css" as="style"><link rel="preload" href="/fe-notes/assets/js/app.43266941.js" as="script"><link rel="preload" href="/fe-notes/assets/js/60.0b90961e.js" as="script"><link rel="prefetch" href="/fe-notes/assets/js/10.fb928311.js"><link rel="prefetch" href="/fe-notes/assets/js/11.aadaf7d9.js"><link rel="prefetch" href="/fe-notes/assets/js/12.c2a5044d.js"><link rel="prefetch" href="/fe-notes/assets/js/13.83caf465.js"><link rel="prefetch" href="/fe-notes/assets/js/14.ffcf277d.js"><link rel="prefetch" href="/fe-notes/assets/js/15.221d7ea1.js"><link rel="prefetch" href="/fe-notes/assets/js/16.2117d375.js"><link rel="prefetch" href="/fe-notes/assets/js/17.3c337b01.js"><link rel="prefetch" href="/fe-notes/assets/js/18.c1ae868f.js"><link rel="prefetch" href="/fe-notes/assets/js/19.e565064b.js"><link rel="prefetch" href="/fe-notes/assets/js/2.28e58bf3.js"><link rel="prefetch" href="/fe-notes/assets/js/20.aa98cc4b.js"><link rel="prefetch" href="/fe-notes/assets/js/21.965a6f1c.js"><link rel="prefetch" href="/fe-notes/assets/js/22.1e62d5e3.js"><link rel="prefetch" href="/fe-notes/assets/js/23.2b5c528b.js"><link rel="prefetch" href="/fe-notes/assets/js/24.0dcb5f09.js"><link rel="prefetch" href="/fe-notes/assets/js/25.ed24afee.js"><link rel="prefetch" href="/fe-notes/assets/js/26.df2844ae.js"><link rel="prefetch" href="/fe-notes/assets/js/27.bdb6ae41.js"><link rel="prefetch" href="/fe-notes/assets/js/28.39e0481f.js"><link rel="prefetch" href="/fe-notes/assets/js/29.ea964833.js"><link rel="prefetch" href="/fe-notes/assets/js/3.8af03c96.js"><link rel="prefetch" href="/fe-notes/assets/js/30.ec1c75e6.js"><link rel="prefetch" href="/fe-notes/assets/js/31.526532f9.js"><link rel="prefetch" href="/fe-notes/assets/js/32.c33011bd.js"><link rel="prefetch" href="/fe-notes/assets/js/33.e4d4d3e4.js"><link rel="prefetch" href="/fe-notes/assets/js/34.0ce26e85.js"><link rel="prefetch" href="/fe-notes/assets/js/35.5a4fad8a.js"><link rel="prefetch" href="/fe-notes/assets/js/36.1595be48.js"><link rel="prefetch" href="/fe-notes/assets/js/37.e0ce17c3.js"><link rel="prefetch" href="/fe-notes/assets/js/38.640ebbce.js"><link rel="prefetch" href="/fe-notes/assets/js/39.ddadeb4f.js"><link rel="prefetch" href="/fe-notes/assets/js/4.82ea8550.js"><link rel="prefetch" href="/fe-notes/assets/js/40.3f70ec6a.js"><link rel="prefetch" href="/fe-notes/assets/js/41.c168973e.js"><link rel="prefetch" href="/fe-notes/assets/js/42.20197fb1.js"><link rel="prefetch" href="/fe-notes/assets/js/43.477a58bd.js"><link rel="prefetch" href="/fe-notes/assets/js/44.447ee589.js"><link rel="prefetch" href="/fe-notes/assets/js/45.658fe318.js"><link rel="prefetch" href="/fe-notes/assets/js/46.089c988d.js"><link rel="prefetch" href="/fe-notes/assets/js/47.f508b246.js"><link rel="prefetch" href="/fe-notes/assets/js/48.7dc7c3ad.js"><link rel="prefetch" href="/fe-notes/assets/js/49.0d6ba307.js"><link rel="prefetch" href="/fe-notes/assets/js/5.8000d0fb.js"><link rel="prefetch" href="/fe-notes/assets/js/50.75b49f6e.js"><link rel="prefetch" href="/fe-notes/assets/js/51.dfb8c173.js"><link rel="prefetch" href="/fe-notes/assets/js/52.721163ea.js"><link rel="prefetch" href="/fe-notes/assets/js/53.2a0be6ab.js"><link rel="prefetch" href="/fe-notes/assets/js/54.1b1d5c10.js"><link rel="prefetch" href="/fe-notes/assets/js/55.a99bd7ac.js"><link rel="prefetch" href="/fe-notes/assets/js/56.f52cb796.js"><link rel="prefetch" href="/fe-notes/assets/js/57.573d120d.js"><link rel="prefetch" href="/fe-notes/assets/js/58.45fa381c.js"><link rel="prefetch" href="/fe-notes/assets/js/59.49ee2f42.js"><link rel="prefetch" href="/fe-notes/assets/js/6.0d738f92.js"><link rel="prefetch" href="/fe-notes/assets/js/61.253d77e2.js"><link rel="prefetch" href="/fe-notes/assets/js/62.c07675c5.js"><link rel="prefetch" href="/fe-notes/assets/js/63.f019a42f.js"><link rel="prefetch" href="/fe-notes/assets/js/64.4faa1e06.js"><link rel="prefetch" href="/fe-notes/assets/js/65.49ad871b.js"><link rel="prefetch" href="/fe-notes/assets/js/66.a8b893a2.js"><link rel="prefetch" href="/fe-notes/assets/js/67.ff15d1ad.js"><link rel="prefetch" href="/fe-notes/assets/js/68.0c74815b.js"><link rel="prefetch" href="/fe-notes/assets/js/69.3829413b.js"><link rel="prefetch" href="/fe-notes/assets/js/7.52af0d3a.js"><link rel="prefetch" href="/fe-notes/assets/js/70.34779f17.js"><link rel="prefetch" href="/fe-notes/assets/js/71.0f2f8855.js"><link rel="prefetch" href="/fe-notes/assets/js/72.c93416e6.js"><link rel="prefetch" href="/fe-notes/assets/js/73.2aa63098.js"><link rel="prefetch" href="/fe-notes/assets/js/74.ed3430df.js"><link rel="prefetch" href="/fe-notes/assets/js/75.76d572c4.js"><link rel="prefetch" href="/fe-notes/assets/js/76.2b62e0fd.js"><link rel="prefetch" href="/fe-notes/assets/js/77.4ba23c48.js"><link rel="prefetch" href="/fe-notes/assets/js/78.e51bf096.js"><link rel="prefetch" href="/fe-notes/assets/js/79.89f9cab4.js"><link rel="prefetch" href="/fe-notes/assets/js/8.452fddde.js"><link rel="prefetch" href="/fe-notes/assets/js/80.8d53b12f.js"><link rel="prefetch" href="/fe-notes/assets/js/81.b6ba5f90.js"><link rel="prefetch" href="/fe-notes/assets/js/82.e6f90536.js"><link rel="prefetch" href="/fe-notes/assets/js/83.51689d6c.js"><link rel="prefetch" href="/fe-notes/assets/js/84.0d91a7c0.js"><link rel="prefetch" href="/fe-notes/assets/js/9.183d73fe.js">
    <link rel="stylesheet" href="/fe-notes/assets/css/0.styles.b7c73eeb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe-notes/" class="home-link router-link-active"><!----> <span class="site-name">余生的前端笔记本</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe-notes/Frontend/" class="nav-link">大前端</a></div><div class="nav-item"><a href="/fe-notes/notes/" class="nav-link">笔记本</a></div><div class="nav-item"><a href="/fe-notes/Vue/VueBasic/VueRespond.html" class="nav-link">Vue</a></div><div class="nav-item"><a href="/fe-notes/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/fe-notes/CodeTools/VSCode/VSCodeVue.html" class="nav-link">code工具</a></div><div class="nav-item"><a href="/fe-notes/dzh/Explain.html" class="nav-link">大杂烩</a></div><div class="nav-item"><a href="https://xn213.github.io/FrontEndNav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  余生博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe-notes/Frontend/" class="nav-link">大前端</a></div><div class="nav-item"><a href="/fe-notes/notes/" class="nav-link">笔记本</a></div><div class="nav-item"><a href="/fe-notes/Vue/VueBasic/VueRespond.html" class="nav-link">Vue</a></div><div class="nav-item"><a href="/fe-notes/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/fe-notes/CodeTools/VSCode/VSCodeVue.html" class="nav-link">code工具</a></div><div class="nav-item"><a href="/fe-notes/dzh/Explain.html" class="nav-link">大杂烩</a></div><div class="nav-item"><a href="https://xn213.github.io/FrontEndNav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  余生博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Vue 基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>VueJs 项目实践</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue Component</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue Router</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vuex</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue 移动端</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue 遇到的问题</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Vue 源码</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/fe-notes/Vue/Vue/vue-prototype.html" class="sidebar-link">Vue 构造函数整理-原型</a></li><li><a href="/fe-notes/Vue/Vue/vue-global-api.html" class="sidebar-link">Vue 构造函数整理-全局API</a></li><li><a href="/fe-notes/Vue/Vue/vue-ins.html" class="sidebar-link">Vue 实例的设计</a></li><li><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html" class="active sidebar-link">Vue 从源码学习之面试题目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html#_1-“new-vue-做了什么？”" class="sidebar-link">1. “new Vue()做了什么？”</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html#_2-“什么阶段才能访问dom？”" class="sidebar-link">2. “什么阶段才能访问DOM？”</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html#_3-“谈谈你对vue的生命周期的理解”" class="sidebar-link">3. “谈谈你对Vue的生命周期的理解”</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html#_4-“vue-router-路由模式有几种？”" class="sidebar-link">4. “Vue-router 路由模式有几种？”</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html#_5-“谈谈你对keep-alive的了解？”" class="sidebar-link">5. “谈谈你对keep-alive的了解？”</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Vue/Vue/从源码学习之Vue面试题目.html#_6-“了解vue2-6-新全局api：vue-observable-吗？”" class="sidebar-link">6. “了解Vue2.6+新全局API：Vue.observable()吗？”</a></li></ul></li><li><a href="/fe-notes/Vue/Vue/Vue源码中的高级js.html" class="sidebar-link">Vue 从源码学习之 JS 骚操作</a></li><li><a href="/fe-notes/Vue/Vue/vue-props.html" class="sidebar-link">Vue 从源码学习之 Vue选项Props</a></li><li><a href="/fe-notes/Vue/Vue/shared-util.html" class="sidebar-link">shared/util.js 文件工具方法全解</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue-从源码学习之面试题目"><a href="#vue-从源码学习之面试题目" aria-hidden="true" class="header-anchor">#</a> Vue 从源码学习之面试题目</h1> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p><a href="https://juejin.im/post/5c959f74f265da610c068fa8" target="_blank" rel="noopener noreferrer">原文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>当回答面试官问及的Vue问题，我们除了照本宣科的回答外，其实还可以根据少量的源码来秀一把，来体现出你对Vue的深度了解。</p> <p>本文会陆续更新，此次涉及以下问题：</p> <h2 id="_1-“new-vue-做了什么？”"><a href="#_1-“new-vue-做了什么？”" aria-hidden="true" class="header-anchor">#</a> 1. “<code>new Vue()</code>做了什么？”</h2> <p><code>new</code>关键字代表实例化一个对象, 而<code>Vue</code>实际上是一个类, 源码位置是<code>/src/core/instance/index.js</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接着我们跳转追踪至<code>this._init()</code>，即<code>Vue.prototype._init</code>,位于<code>src\core\instance\init.js</code>
在<code>_init()</code>方法的内部有一系列 <code>init*</code> 的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">?</span><span class="token punctuation">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm<span class="token punctuation">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// ...忽略，从第45行看起</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initProxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_renderProxy <span class="token operator">=</span> vm
  <span class="token punctuation">}</span>
  <span class="token comment">// expose real self</span>
  vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm
  <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span>
  <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
  <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span>
  <span class="token comment">// ...忽略</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-1-这里我们概述一遍："><a href="#_1-1-这里我们概述一遍：" aria-hidden="true" class="header-anchor">#</a> 1.1 这里我们概述一遍：</h3> <ol><li><code>initProxy</code>，作用域代理，拦截组件内访问其它组件的数据。</li> <li><code>initLifecycle</code>, 建立父子组件关系，在当前实例上添加一些属性和生命周期标识。如：<code>$children</code>、<code>$refs</code>、<code>_isMounted</code>等。</li> <li><code>initEvents</code>，用来存放除<code>@hook:生命周期钩子名称=&quot;绑定的函数&quot;</code>事件的对象。如：<code>$on</code>、<code>$emit</code>等。</li> <li><code>initRender</code>，用于初始化<code>$slots</code>、<code>$attrs</code>、<code>$listeners</code></li> <li><code>initInjections</code>，初始化<code>inject</code>，一般用于更深层次的组件通信，相当于加强版的<code>props</code>。用于组件库开发较多。</li></ol> <blockquote><p>只要在上一层级的声明的provide，那么下一层级无论多深都能够通过inject来访问到provide的数据。这么做也是有明显的缺点：在任意层级都能访问，导致数据追踪比较困难，不知道是哪一个层级声明了这个或者不知道哪一层级或若干个层级使用。</p></blockquote> <ul><li><code>initState</code>，是很多选项初始化的汇总，包括：<code>props、methods、data、computed 和 watch</code> 等。</li> <li><code>initProvide</code>，初始化<code>provide</code>。</li> <li><code>vm.$mount</code>，挂载实例。</li></ul> <h2 id="_2-“什么阶段才能访问dom？”"><a href="#_2-“什么阶段才能访问dom？”" aria-hidden="true" class="header-anchor">#</a> 2. “什么阶段才能访问DOM？”</h2> <p>这个回答可以从<code>beforeCreate</code>以及 <code>created</code> 的调用时机谈起，我们根据上面的概述，来简化下代码:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span>
<span class="token comment">// 初始化 inject</span>
<span class="token comment">// 初始化 props、methods、data、computed 和 watch</span>
<span class="token comment">// 初始化 provide</span>
<span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span>
<span class="token comment">// 挂载实例 vm.$mount(vm.$options.el)</span>
</code></pre></div><p>所以当面试官问你：</p> <ul><li><code>beforeCreate</code>以及 <code>created</code> 调用时，哪些数据能用与否？</li> <li>什么阶段才能访问DOM？</li> <li>为什么<code>created</code>之后才挂载实例？</li></ul> <p>知道怎么回答了吧。</p> <h2 id="_3-“谈谈你对vue的生命周期的理解”"><a href="#_3-“谈谈你对vue的生命周期的理解”" aria-hidden="true" class="header-anchor">#</a> 3. “谈谈你对Vue的生命周期的理解”</h2> <p>常规回答这里就不说了，来稍微深入点的：</p> <ol><li><code>created/mounted/updated/destroyed</code>，以及对应的<code>before</code>钩子。分别是创建=&gt;挂载=&gt;更新=&gt;销毁。</li> <li><code>Vue</code>源码中定义了一个<code>mergeHook</code>函数来遍历一个常量数组<code>LIFECYCLE_HOOKS</code>，该数组实际上是由与生命周期钩子同名的字符串组成的数组。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// v2.6.10 最新版</span>
<span class="token keyword">var</span> <span class="token constant">LIFECYCLE_HOOKS</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'beforeCreate'</span><span class="token punctuation">,</span>
    <span class="token string">'created'</span><span class="token punctuation">,</span>
    <span class="token string">'beforeMount'</span><span class="token punctuation">,</span>
    <span class="token string">'mounted'</span><span class="token punctuation">,</span>
    <span class="token string">'beforeUpdate'</span><span class="token punctuation">,</span>
    <span class="token string">'updated'</span><span class="token punctuation">,</span>
    <span class="token string">'beforeDestroy'</span><span class="token punctuation">,</span>
    <span class="token string">'destroyed'</span><span class="token punctuation">,</span>
    <span class="token string">'activated'</span><span class="token punctuation">,</span>
    <span class="token string">'deactivated'</span><span class="token punctuation">,</span>
    <span class="token string">'errorCaptured'</span><span class="token punctuation">,</span>
    <span class="token comment">// v2.6+ </span>
    <span class="token string">'serverPrefetch'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>于是，你可以答多<code>activated &amp; deactivated</code>（keep-alive 组件激活/停用）、errorCaptured（v2.5 以上版本有的一个钩子，用于处理错误）这三个。</p></blockquote> <h3 id="_3-1-新生命周期钩子：serverprefetch是什么？"><a href="#_3-1-新生命周期钩子：serverprefetch是什么？" aria-hidden="true" class="header-anchor">#</a> 3.1 新生命周期钩子：<code>serverPrefetch</code>是什么？</h3> <p>可以看到，<code>serverPrefetch</code>前身是<code>ssrPrefetch</code>。顾名思义，这是用来处理ssr的。允许我们在渲染过程中“等待”异步数据。可在任何组件中使用，而不仅仅是路由组件。</p> <p>![](data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="487"></svg>)</p> <p>这里我们贴出一段官方例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Item<span class="token punctuation">.</span>vue <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;item&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">item</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">serverPrefetch</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">fetchItem</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// return the Promise from the action</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'fetchItem'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li><strong>绝大多数的面试官都不会去关注v2.6+ 以后的代码记录和变更</strong>。这里如果你说出这个<code>v2.6.10</code>的变化，啧啧...面试官肯定更加欣赏你。</li></ul> <h3 id="_3-2-生命周期钩子的合并策略"><a href="#_3-2-生命周期钩子的合并策略" aria-hidden="true" class="header-anchor">#</a> 3.2 生命周期钩子的合并策略</h3> <p>拿<code>callHook(vm, 'created')</code>讲，先判断组件的选项中有无对应名字的生命周期钩子，再判断是否有 <code>parentVal(vm)</code>。若存在<code>parentVal(vm)</code>且都有对应的生命周期钩子，则会将两者<code>concat</code>为一个数组(<code>parentVal.concat(childVal</code>))。所以，生命周期钩子其实是可以写成数组。如：</p> <div class="language-js extra-class"><pre class="language-js"><code>created<span class="token punctuation">:</span> <span class="token punctuation">[</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'third'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>钩子函数将按顺序执行。</p> <h2 id="_4-“vue-router-路由模式有几种？”"><a href="#_4-“vue-router-路由模式有几种？”" aria-hidden="true" class="header-anchor">#</a> 4. “Vue-router 路由模式有几种？”</h2> <p>三种 <code>&quot;hash&quot; | &quot;history&quot; | &quot;abstract&quot;</code>，一般人只知道两种<code>&quot;hash&quot; | &quot;history&quot;</code>。</p> <p>这里贴出源码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token string">'history'</span><span class="token punctuation">:</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTML5History</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token keyword">case</span> <span class="token string">'hash'</span><span class="token punctuation">:</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fallback<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token keyword">case</span> <span class="token string">'abstract'</span><span class="token punctuation">:</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbstractHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`invalid mode: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="mode"><a href="#mode" aria-hidden="true" class="header-anchor">#</a> # mode</h4> <p>类型: <code>string</code></p> <p>默认值: <code>&quot;hash&quot; (浏览器环境) | &quot;abstract&quot; (Node.js 环境)</code></p> <p>可选值: <code>&quot;hash&quot; | &quot;history&quot; | &quot;abstract&quot;</code>
配置路由模式:</p> <ul><li><code>hash</code>: 使用 <code>URL hash</code> 值来作路由。支持所有浏览器，包括不支持 <code>HTML5 History Api</code> 的浏览器。</li> <li><code>history</code>: 依赖 <code>HTML5 History</code> API 和服务器配置。查看 <code>HTML5 History</code> 模式。</li> <li><code>abstract</code>: 支持所有 <code>JavaScript</code> 运行环境，如 <code>Node.js</code> 服务器端。如果发现没有浏览器的 <code>API</code>，路由会自动强制进入这个模式.</li></ul> <h2 id="_5-“谈谈你对keep-alive的了解？”"><a href="#_5-“谈谈你对keep-alive的了解？”" aria-hidden="true" class="header-anchor">#</a> 5. “谈谈你对<code>keep-alive</code>的了解？”</h2> <p>先贴一个常规回答：</p> <blockquote><p>keep-alive是 Vue 内置的一个组件，可以使被包含的组件保留状态，或避免重新渲染。
在vue 2.1.0 版本之后，keep-alive新加入了两个属性: include(包含的组件缓存) 与 exclude(排除的组件不缓存，优先级大于include) 。</p></blockquote> <p><strong>然后你可以开始骚了：</strong></p> <ol><li><code>&lt;keep-alive&gt;</code>是 <code>Vue</code> 源码中实现的一个全局抽象组件，通过自定义 <code>render</code> 函数并且利用了插槽来实现数据缓存和更新。它的定义在<code>src/core/components/keep-alive.js</code> 中：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
  abstract<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>所有的抽象组件是通过定义<code>abstract</code>选项来声明的。抽象组件不渲染真实<code>DOM</code>，且不会出现在父子关系的路径上（<code>initLifecycle</code>会忽略抽象组件），相关代码片段：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>abstract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// abstract 即 `ptions.abstract`</span>
  <span class="token comment">// while 循环查找第一个非抽象的父组件</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>abstract <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
  <span class="token punctuation">}</span>
  parent<span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-“了解vue2-6-新全局api：vue-observable-吗？”"><a href="#_6-“了解vue2-6-新全局api：vue-observable-吗？”" aria-hidden="true" class="header-anchor">#</a> 6. “了解<code>Vue2.6+</code>新全局<code>API</code>：<code>Vue.observable()</code>吗？”</h2> <p>Vue2.6+新的全局API是<code>Vue.observable()</code>,它的使用方式：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> vue <span class="token keyword">from</span> vue<span class="token punctuation">;</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">observable</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
   counter<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
   <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token punctuation">(</span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
         </span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token plain-text">
           </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span>counter <span class="token operator">++</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
           Increment counter
         &lt;/ button&gt;
       &lt;/ div&gt;
     );
   },
};
</span></code></pre></div><p>而它定义在<code>/src/core/global-api/index.js</code>第48行：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core/observer/index'</span>
<span class="token comment">// ...</span>
<span class="token comment">// 2.6 explicit observable API</span>
Vue<span class="token punctuation">.</span>observable <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">T</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token function">observe</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token keyword">return</span> obj
<span class="token punctuation">}</span>
</code></pre></div><p>再看看它<code>import</code>的<code>observe</code>，最近一次提交在<code>12/1/2018</code>，唔。。。。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/3/25/169b4b3847ee2778?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt></p> <p><strong>核心就是暴露出<code>observe(obj)</code>观测后的数据，代码啥都没改。懂了吧？</strong></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/fe-notes/assets/js/app.43266941.js" defer></script><script src="/fe-notes/assets/js/60.0b90961e.js" defer></script>
  </body>
</html>
